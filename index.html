<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HST PRO</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/UAParser.js/1.0.35/ua-parser.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
:root {
    --primary: #1e90ff;
    --bg: #0a0a0a;
    --card-bg: #111;
    --font: 'Plus Jakarta Sans', sans-serif;
}
body {
    margin: 0;
    font-family: var(--font);
    background: var(--bg);
    color: #fff;
    display: flex;
    justify-content: center;
}
.wrapper {
    width: 100%;
    max-width: 1100px;
    padding: 40px 20px;
}
.header {
    text-align: center;
    margin-bottom: 40px;
}
.header h1 {
    font-size: 2.8rem;
    color: var(--primary);
    margin: 0;
    text-shadow: 0 0 15px var(--primary);
}
.header p {
    font-size: 1.1rem;
    color: #ccc;
}
.bench-container {
    background: var(--card-bg);
    padding: 30px;
    border-radius: 12px;
    box-shadow: 0 0 30px rgba(0,0,0,0.8);
}
.progress-box {
    margin: 30px 0;
}
.bar-bg {
    background: #222;
    height: 14px;
    border-radius: 7px;
    overflow: hidden;
}
.bar-fill {
    height: 100%;
    width: 0%;
    background: linear-gradient(90deg, var(--primary), #00ffff);
    transition: width 0.3s linear;
}
.realtime-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit,minmax(200px,1fr));
    gap: 20px;
    margin-top: 25px;
}
.stat-card {
    background: #0f0f0f;
    padding: 20px;
    border-radius: 10px;
    border: 1px solid #333;
    box-shadow: inset 0 0 10px #000;
    text-align: center;
}
.stat-label {
    font-size: 0.8rem;
    color: #888;
    margin-bottom: 10px;
}
.stat-val {
    font-size: 1.3rem;
    font-weight: bold;
    color: var(--primary);
}
.btn-run {
    background: var(--primary);
    color: #fff;
    font-size: 1.5rem;
    padding: 18px;
    border: none;
    width: 100%;
    border-radius: 10px;
    font-weight: bold;
    cursor: pointer;
    transition: 0.3s;
}
.btn-run:hover {
    background: #00ffff;
    color: #000;
}
#ui-done {
    text-align: center;
    padding: 30px;
    border: 2px solid #00ff00;
    border-radius: 12px;
    margin-top: 30px;
}
#final-code {
    font-size: 3rem;
    letter-spacing: 12px;
    color: #fff;
    margin-top: 10px;
}
#admin-zone {
    margin-top: 60px;
    padding-top: 40px;
    border-top: 1px dashed #444;
}
.adm-input {
    background: #111;
    border: 1px solid #444;
    color: #fff;
    padding: 15px;
    width: 100%;
    margin: 8px 0 20px;
    border-radius: 8px;
}
.report {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
}
.report td, .report th {
    border: 1px solid #333;
    padding: 12px;
    text-align: left;
}
.report th {
    color: var(--primary);
}
canvas { display: none; }
</style>
</head>
<body>

<div class="wrapper">
    <div class="header">
        <h1>Hardware Stress Test</h1>
        <p>專業 CPU / RAM / GPU / JS / Storage / Network 壓力測試工具</p>
    </div>

    <div class="bench-container">
        <div id="ui-idle">
            <p style="color: var(--primary);">⚠️ 開始測試將對系統硬體進行高負載運算，請確保系統散熱正常。</p>
            <p>測試輪數：30 | 預估耗時：約 25 分鐘</p>
            <button class="btn-run" onclick="startStressTest()">開始測試</button>
        </div>

        <div id="ui-running" style="display:none;">
            <div style="text-align:center; color: var(--primary);" id="task-name">初始化測試...</div>
            <div class="progress-box">
                <div class="bar-bg"><div class="bar-fill" id="bar"></div></div>
                <div style="display:flex; justify-content:space-between; font-size:0.85rem; margin-top:5px;">
                    <span id="pc-text">0%</span>
                    <span id="round-text">ROUND 0/30</span>
                </div>
            </div>

            <div class="realtime-stats">
                <div class="stat-card"><div class="stat-label">CPU Stress</div><div class="stat-val" id="stat-cpu">0 ms</div></div>
                <div class="stat-card"><div class="stat-label">RAM Stress</div><div class="stat-val" id="stat-ram">0 ms</div></div>
                <div class="stat-card"><div class="stat-label">GPU Stress</div><div class="stat-val" id="stat-gpu">0 ms</div></div>
                <div class="stat-card"><div class="stat-label">JS Engine</div><div class="stat-val" id="stat-js">0 ms</div></div>
                <div class="stat-card"><div class="stat-label">Storage IO</div><div class="stat-val" id="stat-storage">0 ms</div></div>
                <div class="stat-card"><div class="stat-label">Network Latency</div><div class="stat-val" id="stat-network">0 ms</div></div>
            </div>
        </div>

        <div id="ui-done">
            <h2 style="color:#00ff00;">測試完成</h2>
            <p>測試報告已生成，驗證碼：</p>
            <div id="final-code">------</div>
        </div>
    </div>

    <div id="admin-zone">
        <h3>ADMIN REPORT</h3>
        <input type="password" id="pass" class="adm-input" placeholder="ACCESS KEY">
        <input type="text" id="code" class="adm-input" placeholder="USER AUTH CODE">
        <button class="btn-run" style="font-size:1rem; padding:12px;" onclick="getStressReport()">查看完整報告</button>
        <div id="report-view"></div>
    </div>
</div>

<canvas id="stress-canvas" width="3840" height="2160"></canvas>

<script>
// Firebase config
const firebaseConfig = {
    apiKey: "AIzaSyCTWMvsv6JylnjCGYvznnfrXnTSAV7JUXk",
    authDomain: "tnt-device-info.firebaseapp.com",
    projectId: "tnt-device-info",
    storageBucket: "tnt-device-info.firebasestorage.app",
    messagingSenderId: "434641237799",
    appId: "1:434641237799:web:7b00cf8dd372e29891db02"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const TOTAL_R = 30;
let logs = { cpu: [], ram: [], gpu: [], js: [], storage: [], network: [] };
const avg = a => a.reduce((x,y)=>x+y,0)/a.length;

// ---------------- Stress Test ----------------
async function startStressTest() {
    document.getElementById('ui-idle').style.display='none';
    document.getElementById('ui-running').style.display='block';
    for(let r=1;r<=TOTAL_R;r++){
        const pcBase=((r-1)/TOTAL_R)*100;
        document.getElementById('round-text').innerText=`ROUND ${r}/${TOTAL_R}`;
        
        let t;
        // CPU
        document.getElementById('task-name').innerText="CPU Stress...";
        t=performance.now(); await cpuStress(); logs.cpu.push(performance.now()-t); document.getElementById('stat-cpu').innerText=Math.round(logs.cpu.at(-1))+' ms';
        document.getElementById('bar').style.width=(pcBase+5)+'%';
        // RAM
        document.getElementById('task-name').innerText="RAM Stress..."; t=performance.now(); await ramStress(); logs.ram.push(performance.now()-t); document.getElementById('stat-ram').innerText=Math.round(logs.ram.at(-1))+' ms';
        document.getElementById('bar').style.width=(pcBase+10)+'%';
        // GPU
        document.getElementById('task-name').innerText="GPU Stress..."; t=performance.now(); await gpuStress(); logs.gpu.push(performance.now()-t); document.getElementById('stat-gpu').innerText=Math.round(logs.gpu.at(-1))+' ms';
        document.getElementById('bar').style.width=(pcBase+15)+'%';
        // JS
        document.getElementById('task-name').innerText="JS Engine..."; t=performance.now(); await jsStress(); logs.js.push(performance.now()-t); document.getElementById('stat-js').innerText=Math.round(logs.js.at(-1))+' ms';
        document.getElementById('bar').style.width=(pcBase+20)+'%';
        // Storage
        document.getElementById('task-name').innerText="Storage IO..."; t=performance.now(); await storageStress(); logs.storage.push(performance.now()-t); document.getElementById('stat-storage').innerText=Math.round(logs.storage.at(-1))+' ms';
        document.getElementById('bar').style.width=(pcBase+25)+'%';
        // Network
        document.getElementById('task-name').innerText="Network Latency..."; t=performance.now(); await networkStress(); logs.network.push(performance.now()-t); document.getElementById('stat-network').innerText=Math.round(logs.network.at(-1))+' ms';
        document.getElementById('pc-text').innerText=Math.round(pcBase+30)+'%';
    }

    const parser=new UAParser();
    const authCode=Math.random().toString(36).substring(2,8).toUpperCase();
    await db.collection('inferno_v4_pro').doc(authCode).set({
        logs,
        ua: parser.getResult(),
        stats:{
            stability:(logs.cpu[0]/logs.cpu.at(-1)*100).toFixed(2),
            score: Math.round(1000000/(avg(logs.cpu)+avg(logs.ram)+avg(logs.gpu)+avg(logs.js)))
        },
        time:new Date().toISOString()
    });

    document.getElementById('ui-running').style.display='none';
    document.getElementById('final-code').innerText=authCode;
    document.getElementById('ui-done').style.display='block';
}

// ----- Stress Test Functions -----
async function cpuStress(){ return new Promise(r=>{let s=0;for(let i=2;i<200000;i++){let p=true;for(let j=2;j*j<=i;j++){if(i%j===0){p=false;break;}} if(p)s+=i;} r(); }); }
async function ramStress(){ return new Promise(r=>{let a=new Float64Array(10_000_000); for(let i=0;i<a.length;i++) a[i]=Math.random(); a.reverse(); a.sort(); r(); }); }
async function gpuStress(){ return new Promise(r=>{const gl=document.getElementById('stress-canvas').getContext('webgl2'); if(!gl){r(); return;} for(let i=0;i<5000;i++){gl.clearColor(Math.random(),Math.random(),Math.random(),1.0); gl.clear(gl.COLOR_BUFFER_BIT);} r();}); }
async function jsStress(){ return new Promise(r=>{const obj=Array.from({length:100_000},(_,i)=>({id:i,val:Math.random()})); obj.map(x=>x.val=Math.sqrt(x.val*1000)); obj.sort((a,b)=>b.val-a.val); r();}); }
async function storageStress(){ return new Promise(r=>{try{const db=indexedDB.open("stressDB",1); db.onsuccess=e=>{r();};}catch{r();} }); }
async function networkStress(){ return new Promise(async r=>{try{await fetch("https://www.google.com",{mode:"no-cors"});}catch{} r();}); }

// ----- Admin Report -----
async function getStressReport(){
    if(document.getElementById('pass').value!=='Oliver_5490') return alert('ACCESS DENIED');
    const c=document.getElementById('code').value.toUpperCase();
    const doc=await db.collection('inferno_v4_pro').doc(c).get();
    if(!doc.exists) return alert('INVALID CODE');
    const d=doc.data();
    const stability=parseFloat(d.stats.stability);
    let statusText=stability>90?"Excellent":(stability>70?"Average":"Poor");
    document.getElementById('report-view').innerHTML=`
        <table class="report">
            <tr><th colspan="2">SYSTEM INFO</th></tr>
            <tr><td>OS / Device</td><td>${d.ua.os.name} | ${d.ua.device.model||'PC'}</td></tr>
            <tr><td>Browser</td><td>${d.ua.browser.name} ${d.ua.browser.version}</td></tr>
            <tr><th colspan="2">STRESS RESULTS (AVG ms)</th></tr>
            <tr><td>CPU</td><td>${Math.round(avg(d.logs.cpu))}</td></tr>
            <tr><td>RAM</td><td>${Math.round(avg(d.logs.ram))}</td></tr>
            <tr><td>GPU</td><td>${Math.round(avg(d.logs.gpu))}</td></tr>
            <tr><td>JS Engine</td><td>${Math.round(avg(d.logs.js))}</td></tr>
            <tr><td>Storage IO</td><td>${Math.round(avg(d.logs.storage))}</td></tr>
            <tr><td>Network</td><td>${Math.round(avg(d.logs.network))}</td></tr>
            <tr><th colspan="2">OVERALL</th></tr>
            <tr><td>Stability</td><td>${d.stats.stability}%</td></tr>
            <tr><td>Status</td><td>${statusText}</td></tr>
            <tr><td>Score</td><td>${d.stats.score}</td></tr>
        </table>
    `;
}
</script>

</body>
</html>